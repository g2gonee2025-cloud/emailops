============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /root/workspace/emailops-vertex-ai
configfile: pytest.ini
plugins: anyio-4.12.0, mock-3.15.1, xdist-3.8.0, langsmith-0.5.0, timeout-2.4.0, cov-7.0.0, asyncio-1.3.0
timeout: 300.0s
timeout method: signal
timeout func_only: False
asyncio: mode=strict, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 23 items

cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_human_config_section PASSED [  4%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_human_config_summary PASSED [  8%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_human_config_unknown_section PASSED [ 13%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_json_config_full PASSED [ 17%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_json_config_section_found PASSED [ 21%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_json_config_section_not_found PASSED [ 26%]
cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_summary_sections PASSED [ 30%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_and_install_dependencies_auto PASSED [ 34%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_exports_success PASSED [ 39%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_index_health_success PASSED [ 43%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_ingest_parser_success PASSED [ 47%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_postgres_fail PASSED [ 52%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_postgres_success PASSED [ 56%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_redis_fail PASSED    [ 60%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_redis_success PASSED [ 65%]
cli/tests/test_doctor.py::TestCmdDoctor::test_check_reranker PASSED      [ 69%]
cli/tests/test_doctor.py::TestCmdDoctor::test_colors_basic PASSED        [ 73%]
cli/tests/test_doctor.py::TestCmdDoctor::test_install_packages PASSED    [ 78%]
cli/tests/test_doctor.py::TestCmdDoctor::test_install_packages_fail PASSED [ 82%]
cli/tests/test_doctor.py::TestCmdDoctor::test_main_all_pass PASSED       [ 86%]
cli/tests/test_doctor.py::TestCmdDoctor::test_normalize_provider PASSED  [ 91%]
cli/tests/test_doctor.py::TestCmdDoctor::test_probe_embeddings PASSED    [ 95%]
cli/tests/test_doctor.py::TestCmdDoctor::test_try_import PASSED          [100%]

================================ tests coverage ================================
_______________ coverage: platform linux, python 3.10.12-final-0 _______________

Name                                                  Stmts   Miss  Cover   Missing
-----------------------------------------------------------------------------------
backend/src/cortex/__init__.py                            0      0   100%
backend/src/cortex/audit/__init__.py                     78     78     0%   7-240
backend/src/cortex/chunking/__init__.py                   0      0   100%
backend/src/cortex/chunking/chunker.py                  203    203     0%   11-550
backend/src/cortex/cli.py                                29     29     0%   8-68
backend/src/cortex/cmd_doctor.py                         47     47     0%   7-84
backend/src/cortex/common/exceptions.py                  68     35    49%   29-32, 36, 64-65, 77-78, 93-95, 110-112, 127-129, 143-144, 158-159, 177-180, 194-195, 212-213, 228-229, 244-246
backend/src/cortex/config/loader.py                     272    211    22%   48-49, 91, 96-116, 120, 125-204, 214-270, 274-287, 291-303, 308-366, 370-382, 386-389, 406-414, 419, 429-430, 440-441, 453-464, 479-495, 504-517
backend/src/cortex/config/models.py                     238     29    88%   33-53, 58-61, 178-179, 253-256
backend/src/cortex/context.py                             6      6     0%   1-8
backend/src/cortex/db/__init__.py                         0      0   100%
backend/src/cortex/db/models.py                         103    103     0%   8-311
backend/src/cortex/db/session.py                         68     68     0%   7-199
backend/src/cortex/domain/__init__.py                     2      2     0%   3-5
backend/src/cortex/domain/models.py                      13     13     0%   3-24
backend/src/cortex/domain_models/__init__.py              3      3     0%   7-23
backend/src/cortex/domain_models/facts_ledger.py         86     86     0%   7-168
backend/src/cortex/domain_models/rag.py                  84     84     0%   7-142
backend/src/cortex/email_processing.py                  124    124     0%   8-345
backend/src/cortex/ingestion/__init__.py                  0      0   100%
backend/src/cortex/ingestion/attachments.py              43     43     0%   7-116
backend/src/cortex/ingestion/attachments_log.py          23     23     0%   5-58
backend/src/cortex/ingestion/backfill.py                 80     80     0%   1-145
backend/src/cortex/ingestion/constants.py                 2      2     0%   5-7
backend/src/cortex/ingestion/conv_loader.py             105    105     0%   6-232
backend/src/cortex/ingestion/conversation_parser.py      68     68     0%   7-170
backend/src/cortex/ingestion/core_manifest.py           211    211     0%   1-447
backend/src/cortex/ingestion/mailroom.py                280    280     0%   8-654
backend/src/cortex/ingestion/models.py                   30     30     0%   5-45
backend/src/cortex/ingestion/parser_email.py            317    317     0%   16-656
backend/src/cortex/ingestion/pii.py                     146    146     0%   12-438
backend/src/cortex/ingestion/processor.py               146    146     0%   7-270
backend/src/cortex/ingestion/quoted_masks.py             32     32     0%   7-88
backend/src/cortex/ingestion/rechunk.py                  35     35     0%   1-78
backend/src/cortex/ingestion/s3_source.py                99     99     0%   8-236
backend/src/cortex/ingestion/text_preprocessor.py        34     34     0%   7-121
backend/src/cortex/ingestion/text_utils.py                3      3     0%   5-9
backend/src/cortex/ingestion/writer.py                  100    100     0%   8-311
backend/src/cortex/llm/__init__.py                        0      0   100%
backend/src/cortex/llm/client.py                          7      7     0%   11-24
backend/src/cortex/llm/doks_scaler.py                   353    353     0%   3-698
backend/src/cortex/llm/runtime.py                       483    483     0%   18-1053
backend/src/cortex/observability.py                     190    190     0%   7-371
backend/src/cortex/orchestration/__init__.py              4      4     0%   7-38
backend/src/cortex/orchestration/graphs.py               87     87     0%   7-230
backend/src/cortex/orchestration/nodes.py               394    394     0%   7-1129
backend/src/cortex/orchestration/states.py               55     55     0%   7-106
backend/src/cortex/prompts/__init__.py                   20     20     0%   3-238
backend/src/cortex/queue.py                             400    400     0%   9-988
backend/src/cortex/rag_api/__init__.py                    0      0   100%
backend/src/cortex/rag_api/models.py                     74     74     0%   7-162
backend/src/cortex/rag_api/routes_answer.py              46     46     0%   7-121
backend/src/cortex/rag_api/routes_chat.py               141    141     0%   7-352
backend/src/cortex/rag_api/routes_draft.py               49     49     0%   7-124
backend/src/cortex/rag_api/routes_ingest.py             174    174     0%   8-503
backend/src/cortex/rag_api/routes_search.py              38     38     0%   7-99
backend/src/cortex/rag_api/routes_summarize.py           45     45     0%   7-102
backend/src/cortex/retrieval/__init__.py                  3      3     0%   7-26
backend/src/cortex/retrieval/_hybrid_helpers.py          53     53     0%   1-131
backend/src/cortex/retrieval/cache.py                    57     57     0%   10-141
backend/src/cortex/retrieval/filter_resolution.py        52     52     0%   1-117
backend/src/cortex/retrieval/filters.py                 159    159     0%   19-330
backend/src/cortex/retrieval/fts_search.py               57     57     0%   8-227
backend/src/cortex/retrieval/hybrid_search.py           166    166     0%   7-422
backend/src/cortex/retrieval/query_classifier.py         68     68     0%   12-256
backend/src/cortex/retrieval/reranking.py                99     99     0%   7-186
backend/src/cortex/retrieval/results.py                  31     31     0%   7-74
backend/src/cortex/retrieval/vector_search.py            17     17     0%   13-74
backend/src/cortex/retrieval/vector_store.py            143    143     0%   8-356
backend/src/cortex/safety/__init__.py                     4      4     0%   11-21
backend/src/cortex/safety/grounding.py                  144    144     0%   8-569
backend/src/cortex/safety/guardrails_client.py           89     89     0%   8-311
backend/src/cortex/safety/policy_enforcer.py             98     98     0%   7-260
backend/src/cortex/text_extraction.py                   574    574     0%   8-849
backend/src/cortex/tools/__init__.py                      2      2     0%   3-5
backend/src/cortex/tools/search.py                        9      9     0%   3-23
backend/src/cortex/utils/__init__.py                     25     25     0%   5-61
backend/src/cortex/utils/atomic_io.py                    20     20     0%   5-38
cli/src/cortex_cli/__init__.py                            0      0   100%
cli/src/cortex_cli/_config_helpers.py                    33      1    97%   49
cli/src/cortex_cli/cmd_db.py                             88     88     0%   9-171
cli/src/cortex_cli/cmd_doctor.py                        570    217    62%   129-132, 149, 162-163, 175-180, 190-191, 195-203, 243, 271-285, 288-291, 318-321, 363, 374-382, 402, 415-416, 428-462, 485, 496-497, 504, 510, 513-514, 520, 524, 528, 535-538, 550-557, 562-567, 577-584, 601, 605-606, 618-619, 624, 658-662, 665-668, 673-677, 692-694, 712-715, 722-724, 736-749, 773-780, 796-809, 819-828, 833-845, 854-863, 870-884, 899-938, 947-950, 953-955, 960, 962, 1094, 1136, 1138, 1140, 1142, 1144, 1146, 1150, 1152, 1154, 1160
cli/src/cortex_cli/cmd_embeddings.py                     71     71     0%   9-157
cli/src/cortex_cli/cmd_s3.py                            111    111     0%   9-197
cli/src/cortex_cli/main.py                              668    668     0%   25-1772
cli/src/cortex_cli/style.py                               6      1    83%   22
cli/src/cortex_cli/tui.py                               123    123     0%   5-263
cli/src/cortex_cli/tui_handlers.py                      258    258     0%   6-495
-----------------------------------------------------------------------------------
TOTAL                                                  9536   8843     7%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
============================= slowest 10 durations =============================
0.07s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_redis_fail
0.06s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_redis_success
0.02s call     cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_summary_sections
0.01s call     cli/tests/test_config_helpers.py::TestConfigHelpers::test_print_human_config_summary
0.01s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_index_health_success
0.01s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_ingest_parser_success
0.01s call     cli/tests/test_doctor.py::TestCmdDoctor::test_main_all_pass
0.01s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_exports_success
0.01s call     cli/tests/test_doctor.py::TestCmdDoctor::test_check_postgres_success

(1 durations < 0.005s hidden.  Use -vv to show these durations.)
============================== 23 passed in 7.96s ==============================
